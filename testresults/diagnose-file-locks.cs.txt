=== Sky Omega File-Based Lock Diagnostic ===
OS:         Microsoft Windows NT 10.0.22631.0
.NET:       10.0.3
Lock dir:   C:\Users\marfr175\AppData\Local\Temp\.sky-omega-lock-diag
PID:        2764
Temp path:  C:\Users\marfr175\AppData\Local\Temp\

[TEST] 1. Create exclusive lock file
    Created and locked: C:\Users\marfr175\AppData\Local\Temp\.sky-omega-lock-diag\test1.lock
    File exists while locked: True
    File exists after dispose: False
  => PASSED

[TEST] 2. Exclusive lock blocks second open
    Correctly blocked with IOException: The process cannot access the file 'C:\Users\marfr175\AppData\Local\Temp\.sky-omega-lock-diag\test2.lock' because it is being used by another process.
  => PASSED

[TEST] 3. Release then re-acquire same file
    First lock acquired
    First lock released. File exists: False
    Second lock acquired successfully
  => PASSED

[TEST] 4. Acquire and release multiple slot files
    Acquired all 6 slots
    Extra acquire correctly blocked: True
    Released all 6 slots
    Re-acquired slot 0 after release
  => PASSED

[TEST] 5. Multi-threaded contention (20 threads, 6 slots)
    Success: 20, Failed: 0
  => PASSED

[TEST] 6. Rapid acquire-release cycling (100 iterations)
    100 cycles in 33ms (0,3ms/cycle)
  => PASSED

[TEST] 7. Cross-process lock visibility
    Parent holds lock
    Child exit code: 0
    Child stdout: LOCKED:IOException:The process cannot access the file 'C:\Users\marfr175\AppData\Local\Temp\.sky-omega-lock-diag\cross-proc.lock' because it is being used by another process.
    Cross-process lock IS visible (correct behavior)
  => PASSED

[TEST] 8. Stale file cleanup (simulating dead process)
    Created stale file with fake PID 99999
    File exists: True
    Can read stale file: 99999
    Deleted stale file. Exists: False
    Acquired lock on cleaned-up slot
  => PASSED

[TEST] 9. Full gate simulation (acquire all, timeout on overflow, release unblocks)
    Acquired all 6 slots
    Overflow attempt: timed out (correct) in 314ms
    Released slot 0
    Waiter acquired after release: True
    All slots cleaned up
  => PASSED


=== Summary ===
Passed: 9
Failed: 0

All tests passed. File-based locking works on this platform.
